name: Check input date

on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        description: "Select environment"
        required: true
        options:
          - dev01
          - dev02
          - dev03
      start_time:
        required: true
        type: string
      end_time:
        required: true
        type: string

jobs:
  get-waf-log:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    outputs:
      waf-log: 
    steps:
      - name: Configure AWS credentials via Assume Role
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::022269452713:role/GitHubActionsAthenaRole  # Update this!
          aws-region: ap-southeast-1  # region of Athena/S3
          role-session-name: github-athena-session

      - name: print input
        run: |
          echo "Start Time: ${{ github.event.inputs.start_time }}"
          echo "Start End: ${{ github.event.inputs.end_time }}"
      - name: Validate input time format
        id: validate
        run: |
          regex='^[0-9]{4}/[0-9]{2}/[0-9]{2}[ ][0-9]{2}:[0-9]{2}:[0-9]{2}$'
          start_time="${{ github.event.inputs.start_time }}"
          end_time="${{ github.event.inputs.end_time }}"

          if [[ ! "$start_time" =~ $regex ]] || [[ ! "$end_time" =~ $regex ]]; then
            echo "## ❌ Invalid time format. Must be 'YYYY/MM/DD HH:MM:SS'" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
          echo "## ✅ Valid time format"
          # Set environment variable
          echo "from_date=${start_time% * }" >> $GITHUB_ENV
          echo "to_date=${ end_time }" >> $GITHUB_ENV
          echo ${{ env.from_date }}
